package br.ufu.facom.lascam.coverageexploiter.analytics.model;

import java.util.SortedSet;
import java.util.concurrent.ConcurrentSkipListSet;

import org.apache.commons.collections4.CollectionUtils;

/**
 * Created by Klerisson on 23/10/2014.
 */
public class ElementsMetric<E extends ElementMetric> extends ConcurrentSkipListSet<ElementMetric> {

    @Override
    public boolean add(ElementMetric elementMetric) {

        if(!super.add(elementMetric)){
            SortedSet<ElementMetric> ss = this.tailSet(elementMetric);
            if(CollectionUtils.isNotEmpty(ss)){
                ElementMetric em = ss.first();
                if(em.getElementPostDate().compareTo(elementMetric.getElementPostDate()) > 0){
                    em.setElementPostDate(elementMetric.getElementPostDate());
                }
                em.increaseHitCounter();
            }
        } else {
            elementMetric.increaseHitCounter();
        }
        return true;
    }
}